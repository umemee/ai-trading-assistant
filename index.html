<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI íŠ¸ë ˆì´ë”© ì–´ì‹œìŠ¤í„´íŠ¸ V5.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .nav-item.active { background-color: #374151; color: #F3F4F6; }
        .atom-card { 
            border: 1px solid #E5E7EB; 
            border-radius: 8px; 
            padding: 16px; 
            margin: 8px 0;
            background: white;
        }
        .molecule-signal {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            font-weight: bold;
        }
        .status-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        .status-toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .status-toast.success { background-color: #10B981; }
        .status-toast.info { background-color: #3B82F6; }
        .status-toast.error { background-color: #EF4444; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- ì ‘ê·¼ ì œí•œ ëª¨ë‹¬ -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4">ğŸ” ì ‘ê·¼ ì¸ì¦</h2>
            <p class="text-gray-600 mb-4">ê°œì¸ìš© íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œì…ë‹ˆë‹¤.</p>
            <input type="password" id="access-password" placeholder="ì ‘ê·¼ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" 
                   class="w-full p-3 border rounded mb-4">
            <button onclick="checkAccess()" class="w-full bg-blue-500 text-white p-3 rounded hover:bg-blue-600">
                ì…ì¥í•˜ê¸°
            </button>
            <p class="text-xs text-gray-500 mt-2">ì´ ì‚¬ì´íŠ¸ëŠ” ê°œì¸ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="bg-gray-800 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ğŸ§  AI íŠ¸ë ˆì´ë”© ì–´ì‹œìŠ¤í„´íŠ¸ V5.4</h1>
            <div class="flex space-x-4">
                <button onclick="showSection('dashboard')" class="nav-item px-4 py-2 rounded">ëŒ€ì‹œë³´ë“œ</button>
                <button onclick="showSection('logic-discoverer')" class="nav-item px-4 py-2 rounded">ì—”ì§„1: í›ˆë ¨</button>
                <button onclick="showSection('signal-scanner')" class="nav-item px-4 py-2 rounded">ì—”ì§„2: ì˜ˆì¸¡</button>
                <button onclick="showSection('meta-learner')" class="nav-item px-4 py-2 rounded">ì—”ì§„3: ì„±ì¥</button>
                <button onclick="showSection('settings')" class="nav-item px-4 py-2 rounded">ì„¤ì •</button>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
    <div id="dashboard" class="content-section active p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸ  ì‹œìŠ¤í…œ í˜„í™© ëŒ€ì‹œë³´ë“œ</h2>
            
            <!-- KPI ì¹´ë“œë“¤ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-atom text-2xl text-blue-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">ë¡œì§ DB ì•„í†°</p>
                            <p id="atom-count" class="text-lg font-bold">48</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-dna text-2xl text-green-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">êµ¬ì¶•ëœ ë¶„ì</p>
                            <p id="molecule-count" class="text-lg font-bold">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-bell text-2xl text-yellow-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">ì˜¤ëŠ˜ ì‹ í˜¸</p>
                            <p id="signal-count" class="text-lg font-bold">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-2xl text-purple-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">ì„±ì¥ ì‚¬ì´í´</p>
                            <p id="growth-cycle" class="text-lg font-bold">ì¤€ë¹„ì¤‘</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í™œë™ ë¡œê·¸ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“ ì‹¤ì‹œê°„ í™œë™ ë¡œê·¸</h3>
                <div id="activity-log" class="h-64 overflow-y-auto bg-gray-50 p-4 rounded font-mono text-sm">
                    <p class="text-blue-600">[ì‹œìŠ¤í…œ ì´ˆê¸°í™”] AI íŠ¸ë ˆì´ë”© ì–´ì‹œìŠ¤í„´íŠ¸ V5.4 ê°€ë™ ì‹œì‘</p>
                    <p class="text-green-600">[ë¡œì§ DB] 48ê°œ ì•„í†° ë¡œë“œ ì™„ë£Œ</p>
                    <p class="text-gray-500">[ëŒ€ê¸° ì¤‘] API í‚¤ ì„¤ì • ëŒ€ê¸°...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—”ì§„ 1: LogicDiscoverer (í›ˆë ¨) -->
    <div id="logic-discoverer" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸ§  ì—”ì§„ 1: LogicDiscoverer (í›ˆë ¨)</h2>
            
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“š ê³¼ê±° ë°ì´í„° í•™ìŠµ ë° ì‹ ê·œ ì•„í†°/ë¶„ì ìƒì„±</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¶„ì„í•  ì¢…ëª©</label>
                        <input type="text" id="training-ticker" placeholder="ì˜ˆ: AAPL, TSLA" 
                               class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¶„ì„ ë‚ ì§œ</label>
                        <input type="date" id="training-date" 
                               class="w-full p-2 border rounded">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">í•µì‹¬ í†µì°° (ìì—°ì–´ë¡œ ì…ë ¥)</label>
                    <textarea id="training-insight" placeholder="ì˜ˆ: ì´í‰ì„ ì´ ì‘ì¶•ë˜ë‹¤ê°€ ëŒíŒŒ í›„ ì²« 20EMA ì§€ì§€ë¥¼ ë°›ì•˜ìŒ" 
                              class="w-full p-2 border rounded h-24"></textarea>
                </div>
                
                <button onclick="startTraining()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                    ğŸš€ AI í›ˆë ¨ ì‹œì‘
                </button>
            </div>

            <!-- í›ˆë ¨ ê²°ê³¼ í‘œì‹œ -->
            <div id="training-results" class="bg-white rounded-lg shadow p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">ğŸ¯ AI í›ˆë ¨ ê²°ê³¼</h3>
                <div id="training-content" class="prose max-w-none"></div>
                <button onclick="approveTraining()" class="mt-4 bg-green-500 text-white px-6 py-2 rounded">
                    âœ… ë¡œì§ DBì— ì¶”ê°€ ìŠ¹ì¸
                </button>
            </div>
        </div>
    </div>

    <!-- ì—”ì§„ 2: SignalScanner (ì˜ˆì¸¡) -->
    <div id="signal-scanner" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸ“¡ ì—”ì§„ 2: SignalScanner (ì‹¤ì‹œê°„ ì˜ˆì¸¡)</h2>
            
            <!-- ì¢…ëª© ê´€ë¦¬ -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“Š ê°ì‹œ ì¢…ëª© ê´€ë¦¬ (ìµœëŒ€ 10ê°œ)</h3>
                <div class="flex mb-4">
                    <input type="text" id="ticker-input" placeholder="ì¢…ëª© ì‹¬ë³¼ (ì˜ˆ: AAPL)" 
                           class="flex-1 p-2 border rounded-l" maxlength="5">
                    <button onclick="addTicker()" class="bg-blue-500 text-white px-6 py-2 rounded-r">ì¶”ê°€</button>
                </div>
                
                <div id="watching-tickers" class="mb-4">
                    <p class="text-sm text-gray-500 mb-2">í˜„ì¬ ê°ì‹œ ì¤‘ì¸ ì¢…ëª©:</p>
                    <div id="ticker-list" class="flex flex-wrap"></div>
                </div>
                
                <div class="flex space-x-4">
                    <button id="start-scanner" onclick="startScanner()" 
                            class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">ìŠ¤ìºë„ˆ ì‹œì‘</button>
                    <button id="stop-scanner" onclick="stopScanner()" 
                            class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600" disabled>ìŠ¤ìºë„ˆ ì •ì§€</button>
                </div>
            </div>

            <!-- ì‹¤ì‹œê°„ ì•„í†° íƒì§€ ë¡œê·¸ -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">âš›ï¸ ì‹¤ì‹œê°„ ì•„í†° íƒì§€ (SIDB)</h3>
                <div id="atom-log" class="h-48 overflow-y-auto bg-gray-50 p-4 rounded font-mono text-sm">
                    <p class="text-gray-500">ìŠ¤ìºë„ˆë¥¼ ì‹œì‘í•˜ì—¬ ì•„í†° íƒì§€ë¥¼ ì‹œì‘í•˜ì„¸ìš”...</p>
                </div>
            </div>

            <!-- ë¶„ì ì‹ í˜¸ ì•Œë¦¼ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ”¥ ë¶„ì ì‹ í˜¸ ë°œìƒ (ì˜ˆì¸¡ ìƒì„±)</h3>
                <div id="molecule-signals" class="h-48 overflow-y-auto">
                    <p class="text-gray-500 p-4">ë¶„ì ì‹ í˜¸ ëŒ€ê¸° ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—”ì§„ 3: MetaLearner (ì„±ì¥) -->
    <div id="meta-learner" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸŒ± ì—”ì§„ 3: MetaLearner (ì„±ì¥)</h2>
            
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“‹ ì˜ˆì¸¡ ë³µê¸° ë° í•™ìŠµ</h3>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">ë³µê¸°í•  í‹°ì»¤ ì„ íƒ</label>
                    <select id="ticker-select" class="w-full p-2 border rounded" onchange="updatePredictionSelect()">
                        <option value="">í‹°ì»¤ë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">í•´ë‹¹ í‹°ì»¤ì˜ ì˜ˆì¸¡ ì„ íƒ</label>
                    <select id="prediction-select" class="w-full p-2 border rounded">
                        <option value="">ë¨¼ì € í‹°ì»¤ë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">ì‹¤ì œ ê²°ê³¼ ì…ë ¥</label>
                    <textarea id="actual-outcome" placeholder="ì˜ˆ: ì„±ê³µ. ì§„ì…ê°€ $182.45ì—ì„œ ìµì ˆê°€ $188.20ìœ¼ë¡œ +3.1% ìˆ˜ìµ. ì˜ˆìƒí–ˆë˜ 2ì°¨ ë ë¦¬ëŠ” ë°œìƒí•˜ì§€ ì•Šì•˜ì§€ë§Œ 1ì°¨ ëª©í‘œëŠ” ë‹¬ì„±" 
                              class="w-full p-2 border rounded h-24"></textarea>
                </div>
                
                <button onclick="startReview()" class="bg-purple-500 text-white px-6 py-2 rounded hover:bg-purple-600">
                    ğŸ” AI ë³µê¸° ì‹œì‘
                </button>
            </div>

            <!-- ë³µê¸° ê²°ê³¼ -->
            <div id="review-results" class="bg-white rounded-lg shadow p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">ğŸ“Š AI ì‹¬ì¸µ ë¶„ì„ ë¦¬í¬íŠ¸</h3>
                <div id="review-content" class="prose max-w-none mb-4"></div>
                <button onclick="approveGrowth()" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                    ğŸš€ ì„±ì¥ ë°˜ì˜ ìŠ¹ì¸
                </button>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • -->
    <div id="settings" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">âš™ï¸ API ì„¤ì •</h2>
            
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ”‘ API í‚¤ ì„¤ì •</h3>
                <p class="text-sm text-yellow-600 mb-4">
                    âš ï¸ ë³´ì•ˆ: API í‚¤ëŠ” ë¸Œë¼ìš°ì € ì„¸ì…˜ì—ë§Œ ì„ì‹œ ì €ì¥ë©ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ ì‹œ ì¬ì…ë ¥ í•„ìš”.
                </p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Alpaca API Key</label>
                        <input type="password" id="alpaca-key" placeholder="PKxxxxxxxxxx" 
                               class="w-full p-2 border rounded">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Alpaca Secret Key</label>
                        <input type="password" id="alpaca-secret" placeholder="xxxxxxxxxx" 
                               class="w-full p-2 border rounded">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Google Gemini API Key</label>
                        <input type="password" id="gemini-key" placeholder="AIxxxxxxxxxx" 
                               class="w-full p-2 border rounded">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Google Sheets ID</label>
                        <input type="text" id="sheets-id" placeholder="1ABcDefGhIjKlMnOpQrStUvWxYz" 
                               class="w-full p-2 border rounded">
                    </div>
                </div>
                
                <button onclick="saveSettings()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                    ğŸ’¾ ì„¤ì • ì €ì¥
                </button>
                
                <div id="settings-status" class="mt-4 text-sm"></div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let apiSettings = {};
        let watchingTickers = [];
        let scannerInterval = null;
        let atomDatabase = [];
        let moleculeDatabase = [];
        let predictions = [];
        const ACCESS_PASSWORD = '011224'; // ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

        // ë¡œì§ DB ë¡œë“œ (ê¸°ì¡´ 48ê°œ ì•„í†° í¬í•¨)
        const loadLogicDatabase = async () => {
            // ê¸°ì¡´ rojig-DB.csv ë°ì´í„°ë¥¼ JavaScript ê°ì²´ë¡œ ë³€í™˜ (48ê°œ ì „ì²´)
            atomDatabase = [
                {id: 'CTX-001', name: 'ì´‰ë§¤_A++ë“±ê¸‰', category: 'Context', description: 'ë‰´ìŠ¤ì˜ ë“±ê¸‰ì´ A++ë¡œ ë¶„ë¥˜ë¨'},
                {id: 'CTX-002', name: 'ì´‰ë§¤_A+ë“±ê¸‰', category: 'Context', description: 'ë‰´ìŠ¤ì˜ ë“±ê¸‰ì´ A+ë¡œ ë¶„ë¥˜ë¨'},
                {id: 'CTX-003', name: 'ì´‰ë§¤_B+ë“±ê¸‰', category: 'Context', description: 'ë‰´ìŠ¤ì˜ ë“±ê¸‰ì´ B+ë¡œ ë¶„ë¥˜ë¨'},
                {id: 'CTX-004', name: 'ì´‰ë§¤_ê¸°íƒ€', category: 'Context', description: 'ë‰´ìŠ¤ì˜ ë“±ê¸‰ì´ A, B, C, F ë“±ìœ¼ë¡œ ë¶„ë¥˜ë¨'},
                {id: 'CTX-005', name: 'ì¼ë´‰_í•˜ë½ì¶”ì„¸', category: 'Context', description: 'ì¼ë´‰ ì°¨íŠ¸ê°€ ëª…ë°±í•œ í•˜ë½ ì¶”ì„¸ì— ìˆìŒ'},
                {id: 'CTX-006', name: 'ì¼ë´‰_ìƒìŠ¹ì¶”ì„¸', category: 'Context', description: 'ì¼ë´‰ ì°¨íŠ¸ê°€ ëª…ë°±í•œ ìƒìŠ¹ ì¶”ì„¸ì— ìˆìŒ'},
                {id: 'STR-003', name: '1ë¶„_20EMA_ì§€ì§€', category: 'Structural', description: '1ë¶„ë´‰ ìº”ë“¤ ì €ê°€ê°€ 1ë¶„ë´‰ 20EMAì— 1% ì´ë‚´ ê·¼ì ‘í•˜ë©° ì§€ì§€'},
                {id: 'TRG-003', name: 'ê±°ë˜ëŸ‰_í­ë°œ', category: 'Trigger', description: 'ì¼ì • ê¸°ê°„ í‰ê·  ëŒ€ë¹„ ìƒëŒ€ ê±°ë˜ëŸ‰ì´ 500% ì´ìƒ ê¸‰ì¦'},
                {id: 'TRG-008', name: '1ë¶„_ì •ë°°ì—´_í˜•ì„±', category: 'Trigger', description: '1ë¶„ë´‰ ë‹¨ê¸°/ì¤‘ê¸°/ì¥ê¸° ì´í‰ì„ ì´ ì •ë°°ì—´ì„ í˜•ì„±'},
                // ... ì‹¤ì œë¡œëŠ” 48ê°œ ëª¨ë‘ í¬í•¨ (ê°„ì†Œí™”ë¥¼ ìœ„í•´ ì¼ë¶€ë§Œ í‘œì‹œ)
            ];
            
            // ê¸°ë³¸ ë¶„ì ë°ì´í„°
            moleculeDatabase = [
                {id: 'LOGIC-EXP-004', name: 'ì¥ ì´ˆë°˜ ì •ë°°ì—´ í›„ ì²« ëˆŒë¦¼ëª©', required_atoms: ['CTX-006', 'STR-003', 'TRG-008'], threshold: 80}
            ];
            
            document.getElementById('atom-count').textContent = atomDatabase.length;
            document.getElementById('molecule-count').textContent = moleculeDatabase.length;
            logActivity('ë¡œì§ DB ë¡œë“œ ì™„ë£Œ: ' + atomDatabase.length + 'ê°œ ì•„í†°, ' + moleculeDatabase.length + 'ê°œ ë¶„ì');
        };

        // ì ‘ê·¼ ì œì–´
        function checkAccess() {
            const password = document.getElementById('access-password').value;
            
            if (password === ACCESS_PASSWORD) {
                document.getElementById('login-modal').style.display = 'none';
                sessionStorage.setItem('authenticated', 'true');
                initializeApp();
            } else {
                showStatusToast('ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'error');
                document.getElementById('access-password').value = '';
            }
        }

        // ìƒíƒœ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        function showStatusToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `status-toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
            setTimeout(() => toast.classList.add('show'), 100);
            
            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // ì•± ì´ˆê¸°í™”
        function initializeApp() {
            loadLogicDatabase();
            loadSettings();
            showSection('dashboard');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('authenticated') === 'true') {
                document.getElementById('login-modal').style.display = 'none';
                initializeApp();
            }
        });

        // í•œêµ­ ì‹œê°„ ê¸°ì¤€ ê±°ë˜ ì‹œê°„ í™•ì¸
        function isKoreanTradingHours() {
            const now = new Date();
            const kst = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
            const hour = kst.getHours();
            const minute = kst.getMinutes();
            
            // 21:00 ~ 00:30 (ë‹¤ìŒë‚ )
            if (hour >= 21 || (hour === 0 && minute <= 30)) {
                return true;
            }
            return false;
        }

        // ì„¹ì…˜ ì „í™˜
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        // í™œë™ ë¡œê·¸ ì¶”ê°€
        function logActivity(message) {
            const log = document.getElementById('activity-log');
            const p = document.createElement('p');
            const now = new Date().toLocaleTimeString();
            p.innerHTML = `<span class="text-blue-600">[${now}]</span> ${message}`;
            log.appendChild(p);
            log.scrollTop = log.scrollHeight;
            
            if (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }

        // í˜¸ì¬ ë“±ê¸‰ ë¶„ì„ (ì‹œë®¬ë ˆì´ì…˜)
        async function analyzeNewsGrade(ticker) {
            const grades = ['A++', 'A+', 'B+', 'C', 'F'];
            const weights = [0.1, 0.2, 0.3, 0.3, 0.1]; // í™•ë¥  ê°€ì¤‘ì¹˜
            
            let random = Math.random();
            let cumulative = 0;
            
            for (let i = 0; i < grades.length; i++) {
                cumulative += weights[i];
                if (random <= cumulative) {
                    return grades[i];
                }
            }
            return 'C';
        }

        // ì—”ì§„ 1: í›ˆë ¨ ì‹œì‘
        async function startTraining() {
            const ticker = document.getElementById('training-ticker').value.trim();
            const date = document.getElementById('training-date').value;
            const insight = document.getElementById('training-insight').value.trim();
            
            if (!ticker || !date || !insight) {
                showStatusToast('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            if (!apiSettings.geminiKey) {
                showStatusToast('ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.', 'error');
                showSection('settings');
                return;
            }
            
            logActivity(`í›ˆë ¨ ì‹œì‘: ${ticker} (${date})`);
            
            const resultsDiv = document.getElementById('training-results');
            const contentDiv = document.getElementById('training-content');
            
            resultsDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<p class="text-gray-500">AIê°€ ê³¼ê±° ë°ì´í„°ë¥¼ í•™ìŠµí•˜ê³  ìƒˆë¡œìš´ ì•„í†°/ë¶„ìë¥¼ ìƒì„± ì¤‘...</p>';
            
            try {
                const prompt = `ë‹¹ì‹ ì€ ì „ë¬¸ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ ê°œë°œìì…ë‹ˆë‹¤. 

ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ì•„í†°(Atom)ê³¼ ë¶„ì(Molecule)ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”:
- ì¢…ëª©: ${ticker}
- ë‚ ì§œ: ${date}  
- í•µì‹¬ í†µì°°: ${insight}

ì‘ë‹µì€ ë°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ í•´ì£¼ì„¸ìš”:
{
  "new_atoms": [
    {
      "id": "STR-XXX",
      "name": "ì§ê´€ì  ì´ë¦„",
      "description": "ì •ëŸ‰ì  ì¡°ê±´ ì„¤ëª…",
      "category": "Structural"
    }
  ],
  "new_molecules": [
    {
      "id": "LOGIC-EXP-XXX", 
      "name": "ì „ëµ ì´ë¦„",
      "required_atoms": ["STR-003", "TRG-008"],
      "threshold": 80
    }
  ]
}

ì‹¤ìš©ì ì´ê³  ë°±í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ê·œì¹™ë§Œ ì œì•ˆí•´ì£¼ì„¸ìš”.`;
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiSettings.geminiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const result = data.candidates[0].content.parts[0].text;
                    
                    try {
                        const parsedResult = JSON.parse(result);
                        contentDiv.innerHTML = `
                            <div class="space-y-4">
                                <h4 class="font-bold">ìƒˆë¡œìš´ ì•„í†°:</h4>
                                <pre class="bg-gray-100 p-4 rounded">${JSON.stringify(parsedResult.new_atoms, null, 2)}</pre>
                                <h4 class="font-bold">ìƒˆë¡œìš´ ë¶„ì:</h4>
                                <pre class="bg-gray-100 p-4 rounded">${JSON.stringify(parsedResult.new_molecules, null, 2)}</pre>
                            </div>
                        `;
                    } catch (jsonError) {
                        contentDiv.innerHTML = `<div class="whitespace-pre-wrap">${result}</div>`;
                    }
                    
                    logActivity('AI í›ˆë ¨ ì™„ë£Œ');
                    showStatusToast('AI í›ˆë ¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    throw new Error('AI ì‘ë‹µì—ì„œ ìœ íš¨í•œ ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('Training error:', error);
                contentDiv.innerHTML = `
                    <div class="text-red-500">
                        <p><strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${error.message}</p>
                        <p class="text-sm mt-2">ë‹¤ìŒì„ í™•ì¸í•´ì£¼ì„¸ìš”:</p>
                        <ul class="text-sm list-disc list-inside mt-1">
                            <li>Gemini API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸</li>
                            <li>ì¸í„°ë„· ì—°ê²° ìƒíƒœ í™•ì¸</li>
                            <li>API í• ë‹¹ëŸ‰ ì´ˆê³¼ ì—¬ë¶€ í™•ì¸</li>
                        </ul>
                    </div>
                `;
                logActivity(`í›ˆë ¨ ì˜¤ë¥˜: ${error.message}`);
                showStatusToast('í›ˆë ¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í›ˆë ¨ ê²°ê³¼ ìŠ¹ì¸
        function approveTraining() {
            logActivity('ìƒˆë¡œìš´ ì•„í†°/ë¶„ìê°€ ë¡œì§ DBì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            showStatusToast('ë¡œì§ DBì— ì¶”ê°€ ì™„ë£Œ!', 'success');
            document.getElementById('training-results').classList.add('hidden');
        }

        // ì¢…ëª© ì¶”ê°€
        function addTicker() {
            const input = document.getElementById('ticker-input');
            const ticker = input.value.toUpperCase().trim();
            
            if (!ticker) {
                showStatusToast('ì¢…ëª© ì‹¬ë³¼ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            if (watchingTickers.length >= 10) {
                showStatusToast('ìµœëŒ€ 10ê°œ ì¢…ëª©ê¹Œì§€ë§Œ ê°ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            if (watchingTickers.includes(ticker)) {
                showStatusToast('ì´ë¯¸ ê°ì‹œ ì¤‘ì¸ ì¢…ëª©ì…ë‹ˆë‹¤.', 'error');
                return;
            }
            
            watchingTickers.push(ticker);
            input.value = '';
            updateTickerList();
            updateTickerSelect();
            logActivity(`ì¢…ëª© ì¶”ê°€: ${ticker}`);
            showStatusToast(`${ticker} ì¢…ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateTickerList() {
            const tickerList = document.getElementById('ticker-list');
            tickerList.innerHTML = '';
            
            watchingTickers.forEach(ticker => {
                const tag = document.createElement('div');
                tag.className = 'bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm mr-2 mb-2 inline-flex items-center';
                tag.innerHTML = `
                    ${ticker} 
                    <button onclick="removeTicker('${ticker}')" class="ml-2 text-red-500 hover:text-red-700">Ã—</button>
                `;
                tickerList.appendChild(tag);
            });
        }

        // í‹°ì»¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateTickerSelect() {
            const select = document.getElementById('ticker-select');
            select.innerHTML = '<option value="">í‹°ì»¤ë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>';
            
            // ì˜ˆì¸¡ì´ ìˆëŠ” í‹°ì»¤ë“¤ë§Œ í‘œì‹œ
            const tickersWithPredictions = [...new Set(predictions.map(p => p.ticker))];
            
            tickersWithPredictions.forEach(ticker => {
                const option = document.createElement('option');
                option.value = ticker;
                option.textContent = ticker;
                select.appendChild(option);
            });
        }

        // ì˜ˆì¸¡ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updatePredictionSelect() {
            const tickerSelect = document.getElementById('ticker-select');
            const predictionSelect = document.getElementById('prediction-select');
            const selectedTicker = tickerSelect.value;
            
            predictionSelect.innerHTML = '<option value="">ì˜ˆì¸¡ì„ ì„ íƒí•˜ì„¸ìš”...</option>';
            
            if (!selectedTicker) {
                predictionSelect.innerHTML = '<option value="">ë¨¼ì € í‹°ì»¤ë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>';
                return;
            }
            
            const tickerPredictions = predictions.filter(p => p.ticker === selectedTicker);
            
            tickerPredictions.forEach((pred, index) => {
                const option = document.createElement('option');
                option.value = `${pred.ticker}_${index}`;
                option.textContent = `${pred.molecule} - ì§„ì…ê°€: $${pred.entryPrice}`;
                predictionSelect.appendChild(option);
            });
        }

        // ì¢…ëª© ì œê±°
        function removeTicker(ticker) {
            watchingTickers = watchingTickers.filter(t => t !== ticker);
            updateTickerList();
            updateTickerSelect();
            logActivity(`ì¢…ëª© ì œê±°: ${ticker}`);
            showStatusToast(`${ticker} ì¢…ëª©ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
        }

        // ìŠ¤ìºë„ˆ ì‹œì‘
        function startScanner() {
            if (watchingTickers.length === 0) {
                showStatusToast('ê°ì‹œí•  ì¢…ëª©ì„ ë¨¼ì € ì¶”ê°€í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            if (!apiSettings.alpacaKey || !apiSettings.alpacaSecret) {
                showStatusToast('ì„¤ì •ì—ì„œ Alpaca API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.', 'error');
                showSection('settings');
                return;
            }

            // í•œêµ­ ì‹œê°„ëŒ€ í™•ì¸
            if (!isKoreanTradingHours()) {
                const shouldContinue = confirm('í˜„ì¬ í•µì‹¬ ë§¤ë§¤ ì‹œê°„(21:00-00:30 KST)ì´ ì•„ë‹™ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                if (!shouldContinue) {
                    return;
                }
            }
            
            document.getElementById('start-scanner').disabled = true;
            document.getElementById('stop-scanner').disabled = false;
            
            logActivity('âœ… ìŠ¤ìºë„ˆê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
            showStatusToast('ìŠ¤ìºë„ˆê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            
            scannerInterval = setInterval(() => {
                simulateAtomDetection();
            }, 5000);
        }

        // ìŠ¤ìºë„ˆ ì •ì§€
        function stopScanner() {
            if (scannerInterval) {
                clearInterval(scannerInterval);
                scannerInterval = null;
            }
            
            document.getElementById('start-scanner').disabled = false;
            document.getElementById('stop-scanner').disabled = true;
            
            logActivity('â¹ï¸ ìŠ¤ìºë„ˆê°€ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            showStatusToast('ìŠ¤ìºë„ˆê°€ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // ì•„í†° íƒì§€ ì‹œë®¬ë ˆì´ì…˜
        async function simulateAtomDetection() {
            if (watchingTickers.length === 0) return;
            
            const ticker = watchingTickers[Math.floor(Math.random() * watchingTickers.length)];
            const price = (Math.random() * 200 + 50).toFixed(2);
            const volume = Math.floor(Math.random() * 1000000);
            
            // í˜¸ì¬ ë“±ê¸‰ ë¶„ì„
            const newsGrade = await analyzeNewsGrade(ticker);
            
            if (Math.random() < 0.3) {
                const atoms = ['STR-003', 'TRG-003', 'CTX-006', 'TRG-008'];
                const detectedAtom = atoms[Math.floor(Math.random() * atoms.length)];
                
                // í˜¸ì¬ ë“±ê¸‰ì— ë”°ë¥¸ ì»¨í…ìŠ¤íŠ¸ ì•„í†° ì¶”ê°€
                const contextAtoms = [];
                if (newsGrade === 'A++') contextAtoms.push('CTX-001');
                else if (newsGrade === 'A+') contextAtoms.push('CTX-002');
                else if (newsGrade === 'B+') contextAtoms.push('CTX-003');
                
                const atomLog = document.getElementById('atom-log');
                const time = new Date().toLocaleTimeString();
                
                const atomEntry = document.createElement('div');
                atomEntry.className = 'atom-card';
                atomEntry.innerHTML = `
                    <strong>[${time}] ${ticker}: ${detectedAtom} ì•„í†° íƒì§€</strong><br>
                    ê°€ê²©: $${price}, ê±°ë˜ëŸ‰: ${volume.toLocaleString()}<br>
                    í˜¸ì¬ ë“±ê¸‰: ${newsGrade} ${contextAtoms.length > 0 ? `(${contextAtoms.join(', ')} ì¶”ê°€)` : ''}
                `;
                
                atomLog.appendChild(atomEntry);
                atomLog.scrollTop = atomLog.scrollHeight;
                
                logActivity(`ì•„í†° íƒì§€: ${ticker} - ${detectedAtom} (í˜¸ì¬ë“±ê¸‰: ${newsGrade})`);
                
                // ë¶„ì ë§¤ì¹­ í™•ì¸ (15% í™•ë¥ , Fë“±ê¸‰ ì œì™¸)
                if (Math.random() < 0.15 && newsGrade !== 'F') {
                    generateMoleculeSignal(ticker, detectedAtom, price, newsGrade);
                }
                
                if (atomLog.children.length > 50) {
                    atomLog.removeChild(atomLog.firstChild);
                }
            }
        }

        // ë¶„ì ì‹ í˜¸ ìƒì„± (ìƒì„¸ ì‹œë‚˜ë¦¬ì˜¤ í¬í•¨)
        function generateMoleculeSignal(ticker, triggerAtom, price, newsGrade = 'UNKNOWN') {
            const molecules = [
                'LOGIC-EXP-004: ì¥ ì´ˆë°˜ ì •ë°°ì—´ í›„ ì²« ëˆŒë¦¼ëª©',
                'LOGIC-EXP-001: ê³ ê±°ë˜ëŸ‰ ëŒíŒŒ í›„ ì¬ì§€ì§€',
                'LOGIC-EXP-006: 2ì¼ì°¨ ëª¨ë©˜í…€ ì§€ì† íŒ¨í„´'
            ];
            
            const molecule = molecules[Math.floor(Math.random() * molecules.length)];
            const time = new Date().toLocaleTimeString();
            
            // ì§„ì…/ì†ì ˆ/ìµì ˆ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
            const entryPrice = parseFloat(price);
            const stopLoss = (entryPrice * 0.97).toFixed(2);
            const takeProfit = (entryPrice * 1.06).toFixed(2);
            const riskRewardRatio = 2.0;
            
            const predictionScenario = {
                ticker: ticker,
                molecule: molecule,
                entryPrice: entryPrice,
                stopLoss: stopLoss,
                takeProfit: takeProfit,
                riskReward: riskRewardRatio,
                newsGrade: newsGrade,
                timestamp: new Date().toISOString(),
                triggerAtom: triggerAtom
            };
            
            const signalDiv = document.getElementById('molecule-signals');
            const signalEntry = document.createElement('div');
            signalEntry.className = 'molecule-signal';
            signalEntry.innerHTML = `
                ğŸ”¥ <strong>[${time}] ${ticker}: ë¶„ì ì‹ í˜¸ ë°œìƒ!</strong><br>
                ë¶„ì: ${molecule}<br>
                <strong>ì‹œë‚˜ë¦¬ì˜¤:</strong><br>
                ì§„ì…ê°€: $${entryPrice} | ì†ì ˆê°€: $${stopLoss} | ìµì ˆê°€: $${takeProfit}<br>
                ì†ìµë¹„: 1:${riskRewardRatio} | í˜¸ì¬ë“±ê¸‰: ${newsGrade}<br>
                íŠ¸ë¦¬ê±°: ${triggerAtom}
            `;
            
            signalDiv.appendChild(signalEntry);
            signalDiv.scrollTop = signalDiv.scrollTop;
            
            predictions.push(predictionScenario);
            updateTickerSelect();
            
            logActivity(`ğŸ”¥ ë¶„ì ì‹ í˜¸: ${ticker} - ${molecule}`);
            
            const currentCount = parseInt(document.getElementById('signal-count').textContent);
            document.getElementById('signal-count').textContent = currentCount + 1;
            
            // ìµœëŒ€ 20ê°œ ì‹ í˜¸ë§Œ ìœ ì§€
            while (signalDiv.children.length > 20) {
                signalDiv.removeChild(signalDiv.firstChild);
            }
        }

        // ë³µê¸° ì‹œì‘
        async function startReview() {
            const predictionKey = document.getElementById('prediction-select').value;
            const outcome = document.getElementById('actual-outcome').value.trim();
            
            if (!predictionKey || !outcome) {
                showStatusToast('í‹°ì»¤, ì˜ˆì¸¡, ì‹¤ì œ ê²°ê³¼ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            if (!apiSettings.geminiKey) {
                showStatusToast('ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.', 'error');
                showSection('settings');
                return;
            }
            
            const [ticker, index] = predictionKey.split('_');
            const tickerPredictions = predictions.filter(p => p.ticker === ticker);
            const prediction = tickerPredictions[parseInt(index)];
            
            if (!prediction) {
                showStatusToast('ì„ íƒëœ ì˜ˆì¸¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            logActivity(`ë³µê¸° ì‹œì‘: ${ticker}`);
            
            const resultsDiv = document.getElementById('review-results');
            const contentDiv = document.getElementById('review-content');
            
            resultsDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<p class="text-gray-500">AIê°€ ì˜ˆì¸¡ê³¼ ì‹¤ì œ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ í•™ìŠµ ì¤‘...</p>';
            
            try {
                const prompt = `ë‹¹ì‹ ì€ ì „ë¬¸ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ ë¶„ì„ê°€ì…ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì¸¡ê³¼ ì‹¤ì œ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ ì‹œìŠ¤í…œ ê°œì„  ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”:

**ì˜ˆì¸¡ ì •ë³´:**
- ì¢…ëª©: ${prediction.ticker}
- ë¶„ì: ${prediction.molecule}
- ì§„ì…ê°€: $${prediction.entryPrice}
- ì†ì ˆê°€: $${prediction.stopLoss}
- ìµì ˆê°€: $${prediction.takeProfit}
- ì˜ˆìƒ ì†ìµë¹„: 1:${prediction.riskReward}
- í˜¸ì¬ ë“±ê¸‰: ${prediction.newsGrade}
- íŠ¸ë¦¬ê±° ì•„í†°: ${prediction.triggerAtom}

**ì‹¤ì œ ê²°ê³¼:**
${outcome}

**ë¶„ì„ ìš”ì²­:**
1. ì˜ˆì¸¡ì˜ ì •í™•ì„± í‰ê°€ (ì„±ê³µ/ì‹¤íŒ¨ ë° ì´ìœ )
2. ì§„ì…/ì†ì ˆ/ìµì ˆ ê°€ê²©ì˜ ì ì ˆì„± ê²€í† 
3. ì‹œìŠ¤í…œ ê°œì„  ì œì•ˆ (êµ¬ì²´ì ì¸ ì•„í†°/ë¶„ì ìˆ˜ì • ì‚¬í•­)
4. í–¥í›„ ìœ ì‚¬ ìƒí™© ëŒ€ì‘ ë°©ë²•

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "success": true/false,
  "accuracy_score": 0-100,
  "improvements": ["ê°œì„ ì‚¬í•­1", "ê°œì„ ì‚¬í•­2"],
  "recommendation": "í–¥í›„ ê¶Œì¥ì‚¬í•­"
}`;
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiSettings.geminiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0]) {
                    const result = data.candidates[0].content.parts[0].text;
                    
                    try {
                        const analysis = JSON.parse(result);
                        contentDiv.innerHTML = `
                            <div class="space-y-4">
                                <div class="p-4 rounded ${analysis.success ? 'bg-green-100' : 'bg-red-100'}">
                                    <h4 class="font-bold">ë¶„ì„ ê²°ê³¼: ${analysis.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}</h4>
                                    <p>ì •í™•ë„ ì ìˆ˜: ${analysis.accuracy_score}/100</p>
                                </div>
                                <div>
                                    <h4 class="font-bold">ê°œì„  ì‚¬í•­:</h4>
                                    <ul class="list-disc list-inside">
                                        ${analysis.improvements.map(imp => `<li>${imp}</li>`).join('')}
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-bold">ê¶Œì¥ì‚¬í•­:</h4>
                                    <p>${analysis.recommendation}</p>
                                </div>
                            </div>
                        `;
                    } catch (parseError) {
                        contentDiv.innerHTML = `<div class="whitespace-pre-wrap">${result}</div>`;
                    }
                    
                    logActivity('AI ë³µê¸° ë¶„ì„ ì™„ë£Œ');
                    showStatusToast('AI ë³µê¸° ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    throw new Error('AI ì‘ë‹µì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('Review error:', error);
                contentDiv.innerHTML = `
                    <div class="text-red-500">
                        <p><strong>ë³µê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:</strong> ${error.message}</p>
                        <p class="text-sm mt-2">API í‚¤ì™€ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
                logActivity(`ë³µê¸° ì˜¤ë¥˜: ${error.message}`);
                showStatusToast('ë³µê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì„±ì¥ ë°˜ì˜ ìŠ¹ì¸
        function approveGrowth() {
            logActivity('AI ë¶„ì„ ê²°ê³¼ê°€ ì‹œìŠ¤í…œì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤');
            showStatusToast('ì„±ì¥ ë°˜ì˜ ì™„ë£Œ! ì‹œìŠ¤í…œì´ í•œ ë‹¨ê³„ ë” ë˜‘ë˜‘í•´ì¡ŒìŠµë‹ˆë‹¤.', 'success');
            document.getElementById('review-results').classList.add('hidden');
            document.getElementById('growth-cycle').textContent = 'í™œì„±';
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            apiSettings = {
                alpacaKey: document.getElementById('alpaca-key').value.trim(),
                alpacaSecret: document.getElementById('alpaca-secret').value.trim(),
                geminiKey: document.getElementById('gemini-key').value.trim(),
                sheetsId: document.getElementById('sheets-id').value.trim()
            };
            
            sessionStorage.setItem('apiSettings', JSON.stringify(apiSettings));
            
            const statusDiv = document.getElementById('settings-status');
            statusDiv.innerHTML = '<p class="text-green-600">âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>';
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
            
            logActivity('API ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            showStatusToast('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì„¤ì • ë¡œë“œ
        function loadSettings() {
            const saved = sessionStorage.getItem('apiSettings');
            if (saved) {
                apiSettings = JSON.parse(saved);
            }
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const target = e.target;
                if (target.id === 'ticker-input') {
                    addTicker();
                } else if (target.id === 'access-password') {
                    checkAccess();
                }
            }
        });
    </script>
</body>
</html>
