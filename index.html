<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI íŠ¸ë ˆì´ë”© ì–´ì‹œìŠ¤í„´íŠ¸ V5.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .nav-item.active { background-color: #374151; color: #F3F4F6; }
        .atom-card { 
            border: 1px solid #E5E7EB; 
            border-radius: 8px; 
            padding: 16px; 
            margin: 8px 0;
            background: white;
        }
        .molecule-signal {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="bg-gray-800 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ğŸ§  AI íŠ¸ë ˆì´ë”© ì–´ì‹œìŠ¤í„´íŠ¸ V5.4</h1>
            <div class="flex space-x-4">
                <button onclick="showSection('dashboard')" class="nav-item px-4 py-2 rounded">ëŒ€ì‹œë³´ë“œ</button>
                <button onclick="showSection('logic-discoverer')" class="nav-item px-4 py-2 rounded">ì—”ì§„1: í›ˆë ¨</button>
                <button onclick="showSection('signal-scanner')" class="nav-item px-4 py-2 rounded">ì—”ì§„2: ì˜ˆì¸¡</button>
                <button onclick="showSection('meta-learner')" class="nav-item px-4 py-2 rounded">ì—”ì§„3: ì„±ì¥</button>
                <button onclick="showSection('settings')" class="nav-item px-4 py-2 rounded">ì„¤ì •</button>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
    <div id="dashboard" class="content-section active p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸ  ì‹œìŠ¤í…œ í˜„í™© ëŒ€ì‹œë³´ë“œ</h2>
            
            <!-- KPI ì¹´ë“œë“¤ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-atom text-2xl text-blue-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">ë¡œì§ DB ì•„í†°</p>
                            <p id="atom-count" class="text-lg font-bold">48</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-dna text-2xl text-green-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">êµ¬ì¶•ëœ ë¶„ì</p>
                            <p id="molecule-count" class="text-lg font-bold">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-bell text-2xl text-yellow-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">ì˜¤ëŠ˜ ì‹ í˜¸</p>
                            <p id="signal-count" class="text-lg font-bold">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-2xl text-purple-500 mr-4"></i>
                        <div>
                            <p class="text-sm text-gray-500">ì„±ì¥ ì‚¬ì´í´</p>
                            <p id="growth-cycle" class="text-lg font-bold">ì¤€ë¹„ì¤‘</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í™œë™ ë¡œê·¸ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“ ì‹¤ì‹œê°„ í™œë™ ë¡œê·¸</h3>
                <div id="activity-log" class="h-64 overflow-y-auto bg-gray-50 p-4 rounded font-mono text-sm">
                    <p class="text-blue-600">[ì‹œìŠ¤í…œ ì´ˆê¸°í™”] AI íŠ¸ë ˆì´ë”© ì–´ì‹œìŠ¤í„´íŠ¸ V5.4 ê°€ë™ ì‹œì‘</p>
                    <p class="text-green-600">[ë¡œì§ DB] 48ê°œ ì•„í†° ë¡œë“œ ì™„ë£Œ</p>
                    <p class="text-gray-500">[ëŒ€ê¸° ì¤‘] API í‚¤ ì„¤ì • ëŒ€ê¸°...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—”ì§„ 1: LogicDiscoverer (í›ˆë ¨) -->
    <div id="logic-discoverer" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸ§  ì—”ì§„ 1: LogicDiscoverer (í›ˆë ¨)</h2>
            
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“š ê³¼ê±° ë°ì´í„° í•™ìŠµ ë° ì‹ ê·œ ì•„í†°/ë¶„ì ìƒì„±</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¶„ì„í•  ì¢…ëª©</label>
                        <input type="text" id="training-ticker" placeholder="ì˜ˆ: AAPL, TSLA" 
                               class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¶„ì„ ë‚ ì§œ</label>
                        <input type="date" id="training-date" 
                               class="w-full p-2 border rounded">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">í•µì‹¬ í†µì°° (ìì—°ì–´ë¡œ ì…ë ¥)</label>
                    <textarea id="training-insight" placeholder="ì˜ˆ: ì´í‰ì„ ì´ ì‘ì¶•ë˜ë‹¤ê°€ ëŒíŒŒ í›„ ì²« 20EMA ì§€ì§€ë¥¼ ë°›ì•˜ìŒ" 
                              class="w-full p-2 border rounded h-24"></textarea>
                </div>
                
                <button onclick="startTraining()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                    ğŸš€ AI í›ˆë ¨ ì‹œì‘
                </button>
            </div>

            <!-- í›ˆë ¨ ê²°ê³¼ í‘œì‹œ -->
            <div id="training-results" class="bg-white rounded-lg shadow p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">ğŸ¯ AI í›ˆë ¨ ê²°ê³¼</h3>
                <div id="training-content" class="prose max-w-none"></div>
                <button onclick="approveTraining()" class="mt-4 bg-green-500 text-white px-6 py-2 rounded">
                    âœ… ë¡œì§ DBì— ì¶”ê°€ ìŠ¹ì¸
                </button>
            </div>
        </div>
    </div>

    <!-- ì—”ì§„ 2: SignalScanner (ì˜ˆì¸¡) -->
    <div id="signal-scanner" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸ“¡ ì—”ì§„ 2: SignalScanner (ì‹¤ì‹œê°„ ì˜ˆì¸¡)</h2>
            
            <!-- ì¢…ëª© ê´€ë¦¬ -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“Š ê°ì‹œ ì¢…ëª© ê´€ë¦¬ (ìµœëŒ€ 10ê°œ)</h3>
                <div class="flex mb-4">
                    <input type="text" id="ticker-input" placeholder="ì¢…ëª© ì‹¬ë³¼ (ì˜ˆ: AAPL)" 
                           class="flex-1 p-2 border rounded-l" maxlength="5">
                    <button onclick="addTicker()" class="bg-blue-500 text-white px-6 py-2 rounded-r">ì¶”ê°€</button>
                </div>
                
                <div id="watching-tickers" class="mb-4">
                    <p class="text-sm text-gray-500 mb-2">í˜„ì¬ ê°ì‹œ ì¤‘ì¸ ì¢…ëª©:</p>
                    <div id="ticker-list" class="flex flex-wrap"></div>
                </div>
                
                <div class="flex space-x-4">
                    <button id="start-scanner" onclick="startScanner()" 
                            class="bg-green-500 text-white px-6 py-2 rounded">ìŠ¤ìºë„ˆ ì‹œì‘</button>
                    <button id="stop-scanner" onclick="stopScanner()" 
                            class="bg-red-500 text-white px-6 py-2 rounded" disabled>ìŠ¤ìºë„ˆ ì •ì§€</button>
                </div>
            </div>

            <!-- ì‹¤ì‹œê°„ ì•„í†° íƒì§€ ë¡œê·¸ -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">âš›ï¸ ì‹¤ì‹œê°„ ì•„í†° íƒì§€ (SIDB)</h3>
                <div id="atom-log" class="h-48 overflow-y-auto bg-gray-50 p-4 rounded font-mono text-sm">
                    <p class="text-gray-500">ìŠ¤ìºë„ˆë¥¼ ì‹œì‘í•˜ì—¬ ì•„í†° íƒì§€ë¥¼ ì‹œì‘í•˜ì„¸ìš”...</p>
                </div>
            </div>

            <!-- ë¶„ì ì‹ í˜¸ ì•Œë¦¼ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ”¥ ë¶„ì ì‹ í˜¸ ë°œìƒ (ì˜ˆì¸¡ ìƒì„±)</h3>
                <div id="molecule-signals" class="h-48 overflow-y-auto">
                    <p class="text-gray-500 p-4">ë¶„ì ì‹ í˜¸ ëŒ€ê¸° ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—”ì§„ 3: MetaLearner (ì„±ì¥) -->
    <div id="meta-learner" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">ğŸŒ± ì—”ì§„ 3: MetaLearner (ì„±ì¥)</h2>
            
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“‹ ì˜ˆì¸¡ ë³µê¸° ë° í•™ìŠµ</h3>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">ë³µê¸°í•  ì˜ˆì¸¡ ì„ íƒ</label>
                    <select id="prediction-select" class="w-full p-2 border rounded">
                        <option value="">ì˜ˆì¸¡ì„ ì„ íƒí•˜ì„¸ìš”...</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">ì‹¤ì œ ê²°ê³¼ ì…ë ¥</label>
                    <textarea id="actual-outcome" placeholder="ì˜ˆ: ì„±ê³µ. 2ì°¨ ë ë¦¬ ë°œìƒí•˜ì—¬ +5% ìˆ˜ìµ" 
                              class="w-full p-2 border rounded h-24"></textarea>
                </div>
                
                <button onclick="startReview()" class="bg-purple-500 text-white px-6 py-2 rounded">
                    ğŸ” AI ë³µê¸° ì‹œì‘
                </button>
            </div>

            <!-- ë³µê¸° ê²°ê³¼ -->
            <div id="review-results" class="bg-white rounded-lg shadow p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">ğŸ“Š AI ì‹¬ì¸µ ë¶„ì„ ë¦¬í¬íŠ¸</h3>
                <div id="review-content" class="prose max-w-none mb-4"></div>
                <button onclick="approveGrowth()" class="bg-green-500 text-white px-6 py-2 rounded">
                    ğŸš€ ì„±ì¥ ë°˜ì˜ ìŠ¹ì¸
                </button>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • -->
    <div id="settings" class="content-section p-6">
        <div class="container mx-auto">
            <h2 class="text-2xl font-bold mb-6">âš™ï¸ API ì„¤ì •</h2>
            
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ”‘ API í‚¤ ì„¤ì •</h3>
                <p class="text-sm text-yellow-600 mb-4">
                    âš ï¸ ë³´ì•ˆ: API í‚¤ëŠ” ë¸Œë¼ìš°ì € ì„¸ì…˜ì—ë§Œ ì„ì‹œ ì €ì¥ë©ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ ì‹œ ì¬ì…ë ¥ í•„ìš”.
                </p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Alpaca API Key</label>
                        <input type="password" id="alpaca-key" placeholder="PKxxxxxxxxxx" 
                               class="w-full p-2 border rounded">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Alpaca Secret Key</label>
                        <input type="password" id="alpaca-secret" placeholder="xxxxxxxxxx" 
                               class="w-full p-2 border rounded">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Google Gemini API Key</label>
                        <input type="password" id="gemini-key" placeholder="AIxxxxxxxxxx" 
                               class="w-full p-2 border rounded">
                    </div>
                </div>
                
                <button onclick="saveSettings()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded">
                    ğŸ’¾ ì„¤ì • ì €ì¥
                </button>
                
                <div id="settings-status" class="mt-4 text-sm"></div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let apiSettings = {};
        let watchingTickers = [];
        let scannerInterval = null;
        let atomDatabase = [];
        let moleculeDatabase = [];
        let predictions = [];

        // ë¡œì§ DB ë¡œë“œ (ê¸°ì¡´ 48ê°œ ì•„í†°)
        const loadLogicDatabase = async () => {
            // ê¸°ì¡´ rojig-DB.csv ë°ì´í„°ë¥¼ JavaScript ê°ì²´ë¡œ ë³€í™˜
            atomDatabase = [
                {id: 'CTX-001', name: 'ì´‰ë§¤_A++ë“±ê¸‰', category: 'Context'},
                {id: 'STR-003', name: '1ë¶„_20EMA_ì§€ì§€', category: 'Structural'},
                {id: 'TRG-003', name: 'ê±°ë˜ëŸ‰_í­ë°œ', category: 'Trigger'},
                // ... ì‹¤ì œë¡œëŠ” 48ê°œ ëª¨ë‘ í¬í•¨í•´ì•¼ í•¨
            ];
            
            document.getElementById('atom-count').textContent = atomDatabase.length;
            logActivity('ë¡œì§ DB ë¡œë“œ ì™„ë£Œ: ' + atomDatabase.length + 'ê°œ ì•„í†°');
        };

        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadLogicDatabase();
            loadSettings();
            showSection('dashboard');
        });

        // ì„¹ì…˜ ì „í™˜
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        // í™œë™ ë¡œê·¸ ì¶”ê°€
        function logActivity(message) {
            const log = document.getElementById('activity-log');
            const p = document.createElement('p');
            const now = new Date().toLocaleTimeString();
            p.innerHTML = `<span class="text-blue-600">[${now}]</span> ${message}`;
            log.appendChild(p);
            log.scrollTop = log.scrollHeight;
            
            if (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }

        // ì—”ì§„ 1: í›ˆë ¨ ì‹œì‘
        async function startTraining() {
            const ticker = document.getElementById('training-ticker').value.trim();
            const date = document.getElementById('training-date').value;
            const insight = document.getElementById('training-insight').value.trim();
            
            if (!ticker || !date || !insight) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (!apiSettings.geminiKey) {
                alert('ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.');
                showSection('settings');
                return;
            }
            
            logActivity(`í›ˆë ¨ ì‹œì‘: ${ticker} (${date})`);
            
            const resultsDiv = document.getElementById('training-results');
            const contentDiv = document.getElementById('training-content');
            
            resultsDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<p class="text-gray-500">AIê°€ ê³¼ê±° ë°ì´í„°ë¥¼ í•™ìŠµí•˜ê³  ìƒˆë¡œìš´ ì•„í†°/ë¶„ìë¥¼ ìƒì„± ì¤‘...</p>';
            
            try {
                const prompt = `ë‹¹ì‹ ì€ ì „ë¬¸ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ ê°œë°œìì…ë‹ˆë‹¤. 
                
ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ì•„í†°(Atom)ê³¼ ë¶„ì(Molecule)ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”:
- ì¢…ëª©: ${ticker}
- ë‚ ì§œ: ${date}  
- í•µì‹¬ í†µì°°: ${insight}

ê¸°ì¡´ ë¡œì§ DBì—ëŠ” 48ê°œì˜ ì•„í†°ì´ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ íŒ¨í„´ì„ ë°œê²¬í–ˆë‹¤ë©´ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì œì•ˆí•´ì£¼ì„¸ìš”:

**ì‹ ê·œ ì•„í†°:**
- ID: (ì˜ˆ: STR-019)
- Name: (ì§ê´€ì  ì´ë¦„)
- Description: (ì •ëŸ‰ì  ì¡°ê±´)
- Category: (Context/Structural/Trigger/Derived)

**ì‹ ê·œ ë¶„ì:**
- ID: (ì˜ˆ: LOGIC-EXP-025)
- Name: (ì „ëµ ì´ë¦„)
- Required_Atoms: (í•„ìš”í•œ ì•„í†° IDë“¤)
- Match_Threshold: (ë§¤ì¹­ ì„ê³„ê°’ %)

ì‹¤ìš©ì ì´ê³  ë°±í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ê·œì¹™ë§Œ ì œì•ˆí•´ì£¼ì„¸ìš”.`;
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiSettings.geminiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0]) {
                    const result = data.candidates[0].content.parts[0].text;
                    contentDiv.innerHTML = `<div class="whitespace-pre-wrap">${result}</div>`;
                    logActivity('AI í›ˆë ¨ ì™„ë£Œ');
                } else {
                    contentDiv.innerHTML = '<p class="text-red-500">í›ˆë ¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                }
                
            } catch (error) {
                console.error('Training error:', error);
                contentDiv.innerHTML = '<p class="text-red-500">API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        // í›ˆë ¨ ê²°ê³¼ ìŠ¹ì¸
        function approveTraining() {
            logActivity('ìƒˆë¡œìš´ ì•„í†°/ë¶„ìê°€ ë¡œì§ DBì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            alert('ë¡œì§ DBì— ì¶”ê°€ ì™„ë£Œ! (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Google Sheetsì— ìë™ ì €ì¥ë©ë‹ˆë‹¤)');
            document.getElementById('training-results').classList.add('hidden');
        }

        // ì¢…ëª© ì¶”ê°€
        function addTicker() {
            const input = document.getElementById('ticker-input');
            const ticker = input.value.toUpperCase().trim();
            
            if (!ticker) {
                alert('ì¢…ëª© ì‹¬ë³¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (watchingTickers.length >= 10) {
                alert('ìµœëŒ€ 10ê°œ ì¢…ëª©ê¹Œì§€ë§Œ ê°ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (watchingTickers.includes(ticker)) {
                alert('ì´ë¯¸ ê°ì‹œ ì¤‘ì¸ ì¢…ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            watchingTickers.push(ticker);
            input.value = '';
            updateTickerList();
            logActivity(`ì¢…ëª© ì¶”ê°€: ${ticker}`);
        }

        // ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateTickerList() {
            const tickerList = document.getElementById('ticker-list');
            tickerList.innerHTML = '';
            
            watchingTickers.forEach(ticker => {
                const tag = document.createElement('div');
                tag.className = 'bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm mr-2 mb-2 inline-flex items-center';
                tag.innerHTML = `
                    ${ticker} 
                    <button onclick="removeTicker('${ticker}')" class="ml-2 text-red-500 hover:text-red-700">Ã—</button>
                `;
                tickerList.appendChild(tag);
            });
        }

        // ì¢…ëª© ì œê±°
        function removeTicker(ticker) {
            watchingTickers = watchingTickers.filter(t => t !== ticker);
            updateTickerList();
            logActivity(`ì¢…ëª© ì œê±°: ${ticker}`);
        }

        // ìŠ¤ìºë„ˆ ì‹œì‘
        function startScanner() {
            if (watchingTickers.length === 0) {
                alert('ê°ì‹œí•  ì¢…ëª©ì„ ë¨¼ì € ì¶”ê°€í•˜ì„¸ìš”.');
                return;
            }
            
            if (!apiSettings.alpacaKey || !apiSettings.alpacaSecret) {
                alert('ì„¤ì •ì—ì„œ Alpaca API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.');
                showSection('settings');
                return;
            }
            
            document.getElementById('start-scanner').disabled = true;
            document.getElementById('stop-scanner').disabled = false;
            
            logActivity('ì‹¤ì‹œê°„ ìŠ¤ìºë„ˆ ì‹œì‘');
            
            // ì‹œë®¬ë ˆì´ì…˜: ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Alpaca WebSocket ì—°ê²°
            scannerInterval = setInterval(() => {
                simulateAtomDetection();
            }, 5000); // 5ì´ˆë§ˆë‹¤ ì•„í†° íƒì§€ ì‹œë®¬ë ˆì´ì…˜
        }

        // ìŠ¤ìºë„ˆ ì •ì§€
        function stopScanner() {
            if (scannerInterval) {
                clearInterval(scannerInterval);
                scannerInterval = null;
            }
            
            document.getElementById('start-scanner').disabled = false;
            document.getElementById('stop-scanner').disabled = true;
            
            logActivity('ìŠ¤ìºë„ˆ ì •ì§€');
        }

        // ì•„í†° íƒì§€ ì‹œë®¬ë ˆì´ì…˜
        function simulateAtomDetection() {
            if (watchingTickers.length === 0) return;
            
            const ticker = watchingTickers[Math.floor(Math.random() * watchingTickers.length)];
            const price = (Math.random() * 200 + 50).toFixed(2);
            const volume = Math.floor(Math.random() * 1000000);
            
            // ëœë¤ ì•„í†° íƒì§€ (30% í™•ë¥ )
            if (Math.random() < 0.3) {
                const atoms = ['STR-003', 'TRG-003', 'CTX-006', 'STR-007'];
                const detectedAtom = atoms[Math.floor(Math.random() * atoms.length)];
                
                const atomLog = document.getElementById('atom-log');
                const time = new Date().toLocaleTimeString();
                
                const atomEntry = document.createElement('div');
                atomEntry.className = 'atom-card';
                atomEntry.innerHTML = `
                    <strong>[${time}] ${ticker}: ${detectedAtom} ì•„í†° íƒì§€</strong><br>
                    ê°€ê²©: $${price}, ê±°ë˜ëŸ‰: ${volume.toLocaleString()}
                `;
                
                atomLog.appendChild(atomEntry);
                atomLog.scrollTop = atomLog.scrollHeight;
                
                logActivity(`ì•„í†° íƒì§€: ${ticker} - ${detectedAtom}`);
                
                // ë¶„ì ë§¤ì¹­ í™•ì¸ (15% í™•ë¥ )
                if (Math.random() < 0.15) {
                    generateMoleculeSignal(ticker, detectedAtom, price);
                }
                
                // ìµœëŒ€ 50ê°œ í•­ëª© ìœ ì§€
                if (atomLog.children.length > 50) {
                    atomLog.removeChild(atomLog.firstChild);
                }
            }
        }

        // ë¶„ì ì‹ í˜¸ ìƒì„±
        function generateMoleculeSignal(ticker, triggerAtom, price) {
            const molecules = [
                'LOGIC-EXP-004: ì¥ ì´ˆë°˜ ì •ë°°ì—´ í›„ ì²« ëˆŒë¦¼ëª©',
                'LOGIC-EXP-001: ê³ ê±°ë˜ëŸ‰ ëŒíŒŒ í›„ ì¬ì§€ì§€',
                'META-LOGIC-003: ì»¨ë²„ì „ìŠ¤ ë°˜ë“± íŒ¨í„´'
            ];
            
            const molecule = molecules[Math.floor(Math.random() * molecules.length)];
            const time = new Date().toLocaleTimeString();
            
            const signalDiv = document.getElementById('molecule-signals');
            const signalEntry = document.createElement('div');
            signalEntry.className = 'molecule-signal';
            signalEntry.innerHTML = `
                ğŸ”¥ <strong>[${time}] ${ticker}: ë¶„ì ì‹ í˜¸ ë°œìƒ!</strong><br>
                ë¶„ì: ${molecule}<br>
                íŠ¸ë¦¬ê±° ì•„í†°: ${triggerAtom}<br>
                ê°€ê²©: $${price}
            `;
            
            signalDiv.appendChild(signalEntry);
            signalDiv.scrollTop = signalDiv.scrollHeight;
            
            // ì˜ˆì¸¡ ìƒì„± (ì‹¤ì œë¡œëŠ” Prediction_Notesì— ì €ì¥)
            const prediction = {
                id: `PRED-${Date.now()}`,
                ticker: ticker,
                molecule: molecule,
                time: time,
                price: price
            };
            predictions.push(prediction);
            
            // ì˜ˆì¸¡ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            updatePredictionSelect();
            
            logActivity(`ğŸ”¥ ë¶„ì ì‹ í˜¸: ${ticker} - ${molecule}`);
            
            // ì‹ í˜¸ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            const currentCount = parseInt(document.getElementById('signal-count').textContent);
            document.getElementById('signal-count').textContent = currentCount + 1;
        }

        // ì˜ˆì¸¡ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updatePredictionSelect() {
            const select = document.getElementById('prediction-select');
            select.innerHTML = '<option value="">ì˜ˆì¸¡ì„ ì„ íƒí•˜ì„¸ìš”...</option>';
            
            predictions.forEach(pred => {
                const option = document.createElement('option');
                option.value = pred.id;
                option.textContent = `${pred.time} - ${pred.ticker}: ${pred.molecule}`;
                select.appendChild(option);
            });
        }

        // ë³µê¸° ì‹œì‘
        async function startReview() {
            const predictionId = document.getElementById('prediction-select').value;
            const outcome = document.getElementById('actual-outcome').value.trim();
            
            if (!predictionId || !outcome) {
                alert('ì˜ˆì¸¡ê³¼ ì‹¤ì œ ê²°ê³¼ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            if (!apiSettings.geminiKey) {
                alert('ì„¤ì •ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.');
                showSection('settings');
                return;
            }
            
            const prediction = predictions.find(p => p.id === predictionId);
            if (!prediction) {
                alert('ì„ íƒëœ ì˜ˆì¸¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            logActivity(`ë³µê¸° ì‹œì‘: ${prediction.ticker}`);
            
            const resultsDiv = document.getElementById('review-results');
            const contentDiv = document.getElementById('review-content');
            
            resultsDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<p class="text-gray-500">AIê°€ ì˜ˆì¸¡ê³¼ ì‹¤ì œ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ í•™ìŠµ ì¤‘...</p>';
            
            try {
                const prompt = `ë‹¹ì‹ ì€ ì „ë¬¸ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ ë¶„ì„ê°€ì…ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì¸¡ê³¼ ì‹¤ì œ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ ì‹œìŠ¤í…œ ê°œì„  ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”:

**ì˜ˆì¸¡ ì •ë³´:**
- ì¢…ëª©: ${prediction.ticker}
- ë°œìƒ ì‹œê°„: ${prediction.time}
- ë¶„ì: ${prediction.molecule}
- ê°€ê²©: ${prediction.price}

**ì‹¤ì œ ê²°ê³¼:**
${outcome}

**ë¶„ì„ ìš”ì²­:**
1. ì˜ˆì¸¡ì˜ ì •í™•ì„± í‰ê°€
2. ì„±ê³µ/ì‹¤íŒ¨ ì›ì¸ ë¶„ì„
3. ì‹œìŠ¤í…œ ê°œì„  ì œì•ˆ
4. í–¥í›„ ìœ ì‚¬ ìƒí™© ëŒ€ì‘ ë°©ë²•

êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ê°œì„ ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”.`;
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiSettings.geminiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0]) {
                    const result = data.candidates[0].content.parts[0].text;
                    contentDiv.innerHTML = `<div class="whitespace-pre-wrap">${result}</div>`;
                    logActivity('AI ë³µê¸° ë¶„ì„ ì™„ë£Œ');
                } else {
                    contentDiv.innerHTML = '<p class="text-red-500">ë³µê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                }
                
            } catch (error) {
                console.error('Review error:', error);
                contentDiv.innerHTML = '<p class="text-red-500">API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        // ì„±ì¥ ë°˜ì˜ ìŠ¹ì¸
        function approveGrowth() {
            logActivity('AI ë¶„ì„ ê²°ê³¼ê°€ ì‹œìŠ¤í…œì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤');
            alert('ì„±ì¥ ë°˜ì˜ ì™„ë£Œ! ì‹œìŠ¤í…œì´ í•œ ë‹¨ê³„ ë” ë˜‘ë˜‘í•´ì¡ŒìŠµë‹ˆë‹¤.');
            document.getElementById('review-results').classList.add('hidden');
            document.getElementById('growth-cycle').textContent = 'í™œì„±';
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            apiSettings = {
                alpacaKey: document.getElementById('alpaca-key').value.trim(),
                alpacaSecret: document.getElementById('alpaca-secret').value.trim(),
                geminiKey: document.getElementById('gemini-key').value.trim()
            };
            
            sessionStorage.setItem('apiSettings', JSON.stringify(apiSettings));
            
            const statusDiv = document.getElementById('settings-status');
            statusDiv.innerHTML = '<p class="text-green-600">âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>';
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
            
            logActivity('API ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // ì„¤ì • ë¡œë“œ
        function loadSettings() {
            const saved = sessionStorage.getItem('apiSettings');
            if (saved) {
                apiSettings = JSON.parse(saved);
            }
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const target = e.target;
                if (target.id === 'ticker-input') {
                    addTicker();
                }
            }
        });
    </script>
</body>
</html>
